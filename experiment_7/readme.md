regression with resnet 24 channels, RGB channels are scaled to imagenet
loss function is modified to tackle imbalance structure

from model import load_resnet_model
from train_regression_weighted_loss import train_model
from weighted_MSE_loss import DenseWeight


device = torch.device('cuda' if torch.cuda.is_available() else 'cpu')
model = load_resnet_model('resnet50', num_classes=1)

dense_weight_model = DenseWeight(0.5)

100%|██████████| 8/8 [00:03<00:00,  2.02it/s]
100%|██████████| 8/8 [00:02<00:00,  2.87it/s]
100%|██████████| 8/8 [00:02<00:00,  2.82it/s]
100%|██████████| 8/8 [00:02<00:00,  2.87it/s]
100%|██████████| 8/8 [00:02<00:00,  2.80it/s]
100%|██████████| 8/8 [00:02<00:00,  2.87it/s]
100%|██████████| 8/8 [00:02<00:00,  2.93it/s]
100%|██████████| 8/8 [00:02<00:00,  2.91it/s]
100%|██████████| 8/8 [00:02<00:00,  2.81it/s]
100%|██████████| 8/8 [00:02<00:00,  2.86it/s]
100%|██████████| 8/8 [00:02<00:00,  2.80it/s]
100%|██████████| 8/8 [00:02<00:00,  2.87it/s]
100%|██████████| 4/4 [00:01<00:00,  2.96it/s]
100%|██████████| 8/8 [00:01<00:00,  5.15it/s]
100%|██████████| 8/8 [00:01<00:00,  5.49it/s]
100%|██████████| 8/8 [00:01<00:00,  5.49it/s]
100%|██████████| 8/8 [00:01<00:00,  5.23it/s]
100%|██████████| 3/3 [00:00<00:00,  6.03it/s]
Epoch 1/15, Train Loss: 0.2880, Train R2: -0.3905, Val Loss: 0.2171, Val R2: -0.0962
Model saved as checkpoint_epoch_1.pth
100%|██████████| 8/8 [00:02<00:00,  3.07it/s]
100%|██████████| 8/8 [00:02<00:00,  3.05it/s]
100%|██████████| 8/8 [00:02<00:00,  3.01it/s]
100%|██████████| 8/8 [00:02<00:00,  2.93it/s]
100%|██████████| 8/8 [00:02<00:00,  3.06it/s]
100%|██████████| 8/8 [00:02<00:00,  2.93it/s]
100%|██████████| 8/8 [00:02<00:00,  3.06it/s]
100%|██████████| 8/8 [00:02<00:00,  3.06it/s]
100%|██████████| 8/8 [00:02<00:00,  2.93it/s]
100%|██████████| 8/8 [00:02<00:00,  3.05it/s]
100%|██████████| 8/8 [00:02<00:00,  2.94it/s]
100%|██████████| 8/8 [00:02<00:00,  2.93it/s]
100%|██████████| 4/4 [00:01<00:00,  3.16it/s]
100%|██████████| 8/8 [00:01<00:00,  5.33it/s]
100%|██████████| 8/8 [00:01<00:00,  5.00it/s]
100%|██████████| 8/8 [00:01<00:00,  5.20it/s]
100%|██████████| 8/8 [00:01<00:00,  5.03it/s]
100%|██████████| 3/3 [00:00<00:00,  6.91it/s]
Epoch 2/15, Train Loss: 0.1143, Train R2: 0.4742, Val Loss: 0.1155, Val R2: 0.4499
Model saved as checkpoint_epoch_2.pth
100%|██████████| 8/8 [00:02<00:00,  3.04it/s]
100%|██████████| 8/8 [00:02<00:00,  2.95it/s]
100%|██████████| 8/8 [00:02<00:00,  2.99it/s]
100%|██████████| 8/8 [00:02<00:00,  3.01it/s]
100%|██████████| 8/8 [00:02<00:00,  2.97it/s]
100%|██████████| 8/8 [00:02<00:00,  3.02it/s]
100%|██████████| 8/8 [00:02<00:00,  3.00it/s]
100%|██████████| 8/8 [00:02<00:00,  2.91it/s]
100%|██████████| 8/8 [00:02<00:00,  3.01it/s]
100%|██████████| 8/8 [00:02<00:00,  3.01it/s]
100%|██████████| 8/8 [00:02<00:00,  2.95it/s]
100%|██████████| 8/8 [00:02<00:00,  2.98it/s]
100%|██████████| 4/4 [00:01<00:00,  3.14it/s]
100%|██████████| 8/8 [00:01<00:00,  5.26it/s]
100%|██████████| 8/8 [00:01<00:00,  4.84it/s]
100%|██████████| 8/8 [00:01<00:00,  5.00it/s]
100%|██████████| 8/8 [00:01<00:00,  4.85it/s]
100%|██████████| 3/3 [00:00<00:00,  7.45it/s]
Epoch 3/15, Train Loss: 0.1043, Train R2: 0.5182, Val Loss: 0.1208, Val R2: 0.4203
100%|██████████| 8/8 [00:02<00:00,  3.02it/s]
100%|██████████| 8/8 [00:02<00:00,  2.83it/s]
100%|██████████| 8/8 [00:02<00:00,  2.98it/s]
100%|██████████| 8/8 [00:02<00:00,  2.89it/s]
100%|██████████| 8/8 [00:02<00:00,  2.86it/s]
100%|██████████| 8/8 [00:02<00:00,  3.01it/s]
100%|██████████| 8/8 [00:02<00:00,  2.91it/s]
100%|██████████| 8/8 [00:02<00:00,  2.91it/s]
100%|██████████| 8/8 [00:02<00:00,  3.02it/s]
100%|██████████| 8/8 [00:02<00:00,  2.94it/s]
100%|██████████| 8/8 [00:02<00:00,  2.91it/s]
100%|██████████| 8/8 [00:02<00:00,  2.92it/s]
100%|██████████| 4/4 [00:01<00:00,  3.14it/s]
100%|██████████| 8/8 [00:01<00:00,  5.01it/s]
100%|██████████| 8/8 [00:01<00:00,  4.96it/s]
100%|██████████| 8/8 [00:01<00:00,  5.01it/s]
100%|██████████| 8/8 [00:01<00:00,  5.07it/s]
100%|██████████| 3/3 [00:00<00:00,  7.35it/s]
Epoch 4/15, Train Loss: 0.0946, Train R2: 0.5628, Val Loss: 0.1361, Val R2: 0.3965
100%|██████████| 8/8 [00:02<00:00,  2.91it/s]
100%|██████████| 8/8 [00:02<00:00,  2.91it/s]
100%|██████████| 8/8 [00:02<00:00,  2.88it/s]
100%|██████████| 8/8 [00:02<00:00,  2.91it/s]
100%|██████████| 8/8 [00:02<00:00,  2.91it/s]
100%|██████████| 8/8 [00:02<00:00,  3.02it/s]
100%|██████████| 8/8 [00:02<00:00,  3.00it/s]
100%|██████████| 8/8 [00:02<00:00,  3.01it/s]
100%|██████████| 8/8 [00:02<00:00,  3.03it/s]
100%|██████████| 8/8 [00:02<00:00,  3.02it/s]
100%|██████████| 8/8 [00:02<00:00,  2.95it/s]
100%|██████████| 8/8 [00:02<00:00,  2.99it/s]
100%|██████████| 4/4 [00:01<00:00,  3.13it/s]
100%|██████████| 8/8 [00:01<00:00,  5.21it/s]
100%|██████████| 8/8 [00:01<00:00,  5.20it/s]
100%|██████████| 8/8 [00:01<00:00,  5.04it/s]
100%|██████████| 8/8 [00:01<00:00,  5.10it/s]
100%|██████████| 3/3 [00:00<00:00,  7.18it/s]
Epoch 5/15, Train Loss: 0.0864, Train R2: 0.5994, Val Loss: 0.1707, Val R2: 0.2678
100%|██████████| 8/8 [00:02<00:00,  2.98it/s]
100%|██████████| 8/8 [00:02<00:00,  2.97it/s]
100%|██████████| 8/8 [00:02<00:00,  2.94it/s]
100%|██████████| 8/8 [00:02<00:00,  2.98it/s]
100%|██████████| 8/8 [00:02<00:00,  2.98it/s]
100%|██████████| 8/8 [00:02<00:00,  2.98it/s]
100%|██████████| 8/8 [00:02<00:00,  2.98it/s]
100%|██████████| 8/8 [00:02<00:00,  2.90it/s]
100%|██████████| 8/8 [00:02<00:00,  2.90it/s]
100%|██████████| 8/8 [00:02<00:00,  2.89it/s]
100%|██████████| 8/8 [00:02<00:00,  2.90it/s]
100%|██████████| 8/8 [00:02<00:00,  3.01it/s]
100%|██████████| 4/4 [00:01<00:00,  3.16it/s]
100%|██████████| 8/8 [00:01<00:00,  5.22it/s]
100%|██████████| 8/8 [00:01<00:00,  5.10it/s]
100%|██████████| 8/8 [00:01<00:00,  5.18it/s]
100%|██████████| 8/8 [00:01<00:00,  5.15it/s]
100%|██████████| 3/3 [00:00<00:00,  7.24it/s]
Epoch 6/15, Train Loss: 0.0813, Train R2: 0.6212, Val Loss: 0.1447, Val R2: 0.3658
100%|██████████| 8/8 [00:02<00:00,  2.90it/s]
100%|██████████| 8/8 [00:02<00:00,  2.91it/s]
100%|██████████| 8/8 [00:02<00:00,  2.89it/s]
100%|██████████| 8/8 [00:02<00:00,  2.91it/s]
100%|██████████| 8/8 [00:02<00:00,  2.89it/s]
100%|██████████| 8/8 [00:02<00:00,  2.91it/s]
100%|██████████| 8/8 [00:02<00:00,  3.02it/s]
100%|██████████| 8/8 [00:02<00:00,  3.02it/s]
100%|██████████| 8/8 [00:02<00:00,  2.90it/s]
100%|██████████| 8/8 [00:02<00:00,  2.99it/s]
100%|██████████| 8/8 [00:02<00:00,  2.98it/s]
100%|██████████| 8/8 [00:02<00:00,  2.91it/s]
100%|██████████| 4/4 [00:01<00:00,  3.13it/s]
100%|██████████| 8/8 [00:01<00:00,  5.19it/s]
100%|██████████| 8/8 [00:01<00:00,  4.82it/s]
100%|██████████| 8/8 [00:01<00:00,  5.15it/s]
100%|██████████| 8/8 [00:01<00:00,  4.82it/s]
100%|██████████| 3/3 [00:00<00:00,  7.22it/s]
Epoch 7/15, Train Loss: 0.0813, Train R2: 0.6196, Val Loss: 0.1814, Val R2: 0.2886
100%|██████████| 8/8 [00:02<00:00,  2.98it/s]
100%|██████████| 8/8 [00:02<00:00,  2.94it/s]
100%|██████████| 8/8 [00:02<00:00,  2.85it/s]
100%|██████████| 8/8 [00:02<00:00,  2.90it/s]
100%|██████████| 8/8 [00:02<00:00,  2.93it/s]
100%|██████████| 8/8 [00:02<00:00,  2.90it/s]
100%|██████████| 8/8 [00:02<00:00,  3.00it/s]
100%|██████████| 8/8 [00:02<00:00,  2.89it/s]
100%|██████████| 8/8 [00:02<00:00,  2.85it/s]
100%|██████████| 8/8 [00:02<00:00,  2.89it/s]
100%|██████████| 8/8 [00:02<00:00,  3.03it/s]
100%|██████████| 8/8 [00:02<00:00,  2.97it/s]
100%|██████████| 4/4 [00:01<00:00,  3.11it/s]
100%|██████████| 8/8 [00:01<00:00,  4.81it/s]
100%|██████████| 8/8 [00:01<00:00,  4.84it/s]
100%|██████████| 8/8 [00:01<00:00,  4.83it/s]
100%|██████████| 8/8 [00:01<00:00,  4.90it/s]
100%|██████████| 3/3 [00:00<00:00,  7.27it/s]
Epoch 8/15, Train Loss: 0.0790, Train R2: 0.6281, Val Loss: 0.1283, Val R2: 0.4416
100%|██████████| 8/8 [00:02<00:00,  2.97it/s]
100%|██████████| 8/8 [00:02<00:00,  2.99it/s]
100%|██████████| 8/8 [00:02<00:00,  2.89it/s]
100%|██████████| 8/8 [00:02<00:00,  3.01it/s]
100%|██████████| 8/8 [00:02<00:00,  3.01it/s]
100%|██████████| 8/8 [00:02<00:00,  2.89it/s]
100%|██████████| 8/8 [00:02<00:00,  2.85it/s]
100%|██████████| 8/8 [00:02<00:00,  2.90it/s]
100%|██████████| 8/8 [00:02<00:00,  2.89it/s]
100%|██████████| 8/8 [00:02<00:00,  2.89it/s]
100%|██████████| 8/8 [00:02<00:00,  2.89it/s]
100%|██████████| 8/8 [00:02<00:00,  2.90it/s]
100%|██████████| 4/4 [00:01<00:00,  3.13it/s]
100%|██████████| 8/8 [00:01<00:00,  5.24it/s]
100%|██████████| 8/8 [00:01<00:00,  4.83it/s]
100%|██████████| 8/8 [00:01<00:00,  4.86it/s]
100%|██████████| 8/8 [00:01<00:00,  4.78it/s]
100%|██████████| 3/3 [00:00<00:00,  7.21it/s]
Epoch 9/15, Train Loss: 0.0697, Train R2: 0.6695, Val Loss: 0.1451, Val R2: 0.3580
100%|██████████| 8/8 [00:02<00:00,  2.98it/s]
100%|██████████| 8/8 [00:02<00:00,  2.99it/s]
100%|██████████| 8/8 [00:02<00:00,  2.91it/s]
100%|██████████| 8/8 [00:02<00:00,  2.99it/s]
100%|██████████| 8/8 [00:02<00:00,  2.98it/s]
100%|██████████| 8/8 [00:02<00:00,  2.98it/s]
100%|██████████| 8/8 [00:02<00:00,  2.86it/s]
100%|██████████| 8/8 [00:02<00:00,  3.01it/s]
100%|██████████| 8/8 [00:02<00:00,  3.01it/s]
100%|██████████| 8/8 [00:02<00:00,  2.90it/s]
100%|██████████| 8/8 [00:02<00:00,  3.03it/s]
100%|██████████| 8/8 [00:02<00:00,  3.01it/s]
100%|██████████| 4/4 [00:01<00:00,  3.14it/s]
100%|██████████| 8/8 [00:01<00:00,  5.03it/s]
100%|██████████| 8/8 [00:01<00:00,  4.82it/s]
100%|██████████| 8/8 [00:01<00:00,  4.83it/s]
100%|██████████| 8/8 [00:01<00:00,  4.89it/s]
100%|██████████| 3/3 [00:00<00:00,  7.13it/s]
Epoch 10/15, Train Loss: 0.0599, Train R2: 0.7125, Val Loss: 0.1811, Val R2: 0.0713
100%|██████████| 8/8 [00:02<00:00,  3.00it/s]
100%|██████████| 8/8 [00:02<00:00,  3.01it/s]
100%|██████████| 8/8 [00:02<00:00,  3.03it/s]
100%|██████████| 8/8 [00:02<00:00,  3.00it/s]
100%|██████████| 8/8 [00:02<00:00,  2.86it/s]
100%|██████████| 8/8 [00:02<00:00,  3.00it/s]
100%|██████████| 8/8 [00:02<00:00,  3.02it/s]
100%|██████████| 8/8 [00:02<00:00,  2.89it/s]
100%|██████████| 8/8 [00:02<00:00,  3.01it/s]
100%|██████████| 8/8 [00:02<00:00,  3.00it/s]
100%|██████████| 8/8 [00:02<00:00,  2.91it/s]
100%|██████████| 8/8 [00:02<00:00,  2.90it/s]
100%|██████████| 4/4 [00:01<00:00,  3.13it/s]
100%|██████████| 8/8 [00:01<00:00,  5.18it/s]
100%|██████████| 8/8 [00:01<00:00,  5.14it/s]
100%|██████████| 8/8 [00:01<00:00,  5.15it/s]
100%|██████████| 8/8 [00:01<00:00,  4.83it/s]
100%|██████████| 3/3 [00:00<00:00,  7.27it/s]
Epoch 11/15, Train Loss: 0.0553, Train R2: 0.7338, Val Loss: 0.1522, Val R2: 0.2626
100%|██████████| 8/8 [00:02<00:00,  3.00it/s]
100%|██████████| 8/8 [00:02<00:00,  2.90it/s]
100%|██████████| 8/8 [00:02<00:00,  2.89it/s]
100%|██████████| 8/8 [00:02<00:00,  2.90it/s]
100%|██████████| 8/8 [00:02<00:00,  2.83it/s]
100%|██████████| 8/8 [00:02<00:00,  3.02it/s]
100%|██████████| 8/8 [00:02<00:00,  2.89it/s]
100%|██████████| 8/8 [00:02<00:00,  2.89it/s]
100%|██████████| 8/8 [00:02<00:00,  2.97it/s]
100%|██████████| 8/8 [00:02<00:00,  2.89it/s]
100%|██████████| 8/8 [00:02<00:00,  3.01it/s]
100%|██████████| 8/8 [00:02<00:00,  3.02it/s]
100%|██████████| 4/4 [00:01<00:00,  3.13it/s]
100%|██████████| 8/8 [00:01<00:00,  4.83it/s]
100%|██████████| 8/8 [00:01<00:00,  4.80it/s]
100%|██████████| 8/8 [00:01<00:00,  5.14it/s]
100%|██████████| 8/8 [00:01<00:00,  5.00it/s]
100%|██████████| 3/3 [00:00<00:00,  7.31it/s]
Epoch 12/15, Train Loss: 0.0667, Train R2: 0.6796, Val Loss: 0.1284, Val R2: 0.4136
100%|██████████| 8/8 [00:02<00:00,  3.01it/s]
100%|██████████| 8/8 [00:02<00:00,  2.91it/s]
100%|██████████| 8/8 [00:02<00:00,  2.98it/s]
100%|██████████| 8/8 [00:02<00:00,  2.89it/s]
100%|██████████| 8/8 [00:02<00:00,  2.90it/s]
100%|██████████| 8/8 [00:02<00:00,  2.92it/s]
100%|██████████| 8/8 [00:02<00:00,  2.86it/s]
100%|██████████| 8/8 [00:02<00:00,  3.02it/s]
100%|██████████| 8/8 [00:02<00:00,  2.97it/s]
100%|██████████| 8/8 [00:02<00:00,  2.98it/s]
100%|██████████| 8/8 [00:02<00:00,  2.92it/s]
100%|██████████| 8/8 [00:02<00:00,  3.02it/s]
100%|██████████| 4/4 [00:01<00:00,  3.14it/s]
100%|██████████| 8/8 [00:01<00:00,  5.18it/s]
100%|██████████| 8/8 [00:01<00:00,  4.79it/s]
100%|██████████| 8/8 [00:01<00:00,  4.82it/s]
100%|██████████| 8/8 [00:01<00:00,  4.80it/s]
100%|██████████| 3/3 [00:00<00:00,  7.16it/s]
Epoch 13/15, Train Loss: 0.0488, Train R2: 0.7638, Val Loss: 0.3370, Val R2: -0.3715
100%|██████████| 8/8 [00:02<00:00,  2.89it/s]
100%|██████████| 8/8 [00:02<00:00,  2.89it/s]
100%|██████████| 8/8 [00:02<00:00,  2.96it/s]
100%|██████████| 8/8 [00:02<00:00,  2.90it/s]
100%|██████████| 8/8 [00:02<00:00,  2.90it/s]
100%|██████████| 8/8 [00:02<00:00,  2.89it/s]
100%|██████████| 8/8 [00:02<00:00,  3.01it/s]
100%|██████████| 8/8 [00:02<00:00,  2.89it/s]
100%|██████████| 8/8 [00:02<00:00,  2.90it/s]
100%|██████████| 8/8 [00:02<00:00,  2.91it/s]
100%|██████████| 8/8 [00:02<00:00,  2.99it/s]
100%|██████████| 8/8 [00:02<00:00,  2.91it/s]
100%|██████████| 4/4 [00:01<00:00,  3.13it/s]
100%|██████████| 8/8 [00:01<00:00,  4.84it/s]
100%|██████████| 8/8 [00:01<00:00,  5.14it/s]
100%|██████████| 8/8 [00:01<00:00,  4.65it/s]
100%|██████████| 8/8 [00:01<00:00,  5.01it/s]
100%|██████████| 3/3 [00:00<00:00,  7.26it/s]
Epoch 14/15, Train Loss: 0.0600, Train R2: 0.7091, Val Loss: 0.1817, Val R2: 0.0745
100%|██████████| 8/8 [00:02<00:00,  2.88it/s]
100%|██████████| 8/8 [00:02<00:00,  2.91it/s]
100%|██████████| 8/8 [00:02<00:00,  3.02it/s]
100%|██████████| 8/8 [00:02<00:00,  3.01it/s]
100%|██████████| 8/8 [00:02<00:00,  2.89it/s]
100%|██████████| 8/8 [00:02<00:00,  2.98it/s]
100%|██████████| 8/8 [00:02<00:00,  2.89it/s]
100%|██████████| 8/8 [00:02<00:00,  2.90it/s]
100%|██████████| 8/8 [00:02<00:00,  3.01it/s]
100%|██████████| 8/8 [00:02<00:00,  2.98it/s]
100%|██████████| 8/8 [00:02<00:00,  2.89it/s]
100%|██████████| 8/8 [00:02<00:00,  2.97it/s]
100%|██████████| 4/4 [00:01<00:00,  3.11it/s]
100%|██████████| 8/8 [00:01<00:00,  5.22it/s]
100%|██████████| 8/8 [00:01<00:00,  4.89it/s]
100%|██████████| 8/8 [00:01<00:00,  4.78it/s]
100%|██████████| 8/8 [00:01<00:00,  4.79it/s]
100%|██████████| 3/3 [00:00<00:00,  7.17it/s]
Epoch 15/15, Train Loss: 0.0953, Train R2: 0.5361, Val Loss: 0.1240, Val R2: 0.4193
Model saved as final_model.pth
Training completed and final model saved.
